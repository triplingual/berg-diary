<!DOCTYPE html>
<html>
<head>
	<title>Locating Mary Berg's Diary</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

	<script src='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.js'></script>
	<link href='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.css' rel='stylesheet' />
	<script>
	// Thank you, StackOverflow! 
	// http://stackoverflow.com/questions/2907482/how-to-get-the-query-string-by-javascript
	function getQueryStrings() { 
		var assoc  = {};
		var decode = function (s) { return decodeURIComponent(s.replace(/\+/g, " ")); };
		var queryString = location.search.substring(1); 
		var keyValues = queryString.split('&'); 

		for(var i in keyValues) { 
			var key = keyValues[i].split('=');
			if (key.length > 1) {
				assoc[decode(key[0])] = decode(key[1]);
			}
		} 

		return assoc; 
	} 
	</script>
</head>
<body>
	<div id="map" style="width:60%; height: 600px;float:left;"></div>
	<div id="text" style="width:38%; margin-left:2%; float:left; height:600px; overflow:scroll;">
		<h2>Locating Mary Berg's Diary, 1939&#8211;1944</h2>
		<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean venenatis id elit nec eleifend. Maecenas convallis ex id diam finibus, nec sollicitudin risus ultrices. Nulla rutrum nibh a scelerisque gravida. Integer id quam semper, rhoncus magna eget, condimentum eros. Integer consectetur consequat ipsum, eget lacinia nulla faucibus in. Maecenas interdum tortor eu purus viverra aliquam. Nunc vel porta arcu. Quisque pretium mi a cursus vestibulum. Nunc maximus nisl ac erat ornare fermentum. Nulla vehicula tellus nec aliquet auctor. Aliquam pellentesque quis massa eu consectetur. Nam convallis leo eget ex faucibus interdum ut ac purus.
		</p>
		<p>
		Aenean laoreet aliquet est a euismod. Integer pulvinar dignissim dui ac aliquam. Vivamus faucibus varius nulla vitae luctus. Praesent efficitur arcu augue, vitae consequat ligula finibus vel. Donec dictum, elit vitae tincidunt pellentesque, mauris nisl venenatis ligula, sed congue sapien tellus ut risus. Maecenas aliquam magna eget lacus sollicitudin dapibus. Suspendisse eu tellus at metus dapibus mollis.
		</p>
		<p>
		Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Cras tristique at nulla sit amet faucibus. Praesent ut vestibulum sapien, a imperdiet quam. Phasellus ac fermentum sem. Suspendisse dignissim ac tellus non mattis. Nullam tempus massa in volutpat pellentesque. Praesent et massa id augue mattis mattis. Nam blandit imperdiet sodales. Pellentesque nec nibh odio. Aliquam vel odio nec dolor elementum tristique. Donec lobortis nec eros et rutrum. Proin vitae semper arcu. Fusce lobortis velit et magna pretium laoreet. Quisque ut libero interdum, blandit dui aliquet, lacinia sapien. Proin condimentum et velit nec hendrerit.
		</p>
		<p>
		Curabitur elit nisi, aliquet eget vehicula ac, suscipit vitae sem. Morbi diam augue, mattis ac nunc laoreet, laoreet tincidunt diam. Nunc euismod nisl lectus, vel aliquet leo pretium eu. Phasellus nec neque accumsan lorem luctus laoreet. Quisque gravida quis sem vitae imperdiet. Aenean convallis eros vel dignissim tristique. Sed fringilla, sem sit amet rutrum congue, leo mauris porttitor metus, at ornare leo metus et risus. Donec dolor mauris, laoreet nec nunc vel, tincidunt cursus nulla. Donec auctor et justo id placerat. Aenean tempus nisl quis lectus porttitor, at ornare urna pellentesque. Nulla vitae eleifend velit. Nulla vitae ex non nunc dignissim lobortis lacinia gravida lorem. Nam id ex ac justo convallis blandit ac nec orci. Donec orci ligula, aliquet faucibus lobortis ac, vulputate non nulla.
		</p>
		<p>
		Praesent hendrerit eget nibh interdum imperdiet. Fusce lobortis lorem quis quam bibendum, non rhoncus orci efficitur. Pellentesque at leo odio. Mauris vulputate ligula nisi, eget congue lacus elementum et. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Suspendisse fringilla luctus quam sit amet efficitur. Mauris sed ipsum vel justo facilisis aliquam ut sed ligula. Nunc tristique nunc leo, sed tincidunt eros semper sed. Ut posuere, diam ac pharetra gravida, ligula tortor pellentesque lectus, ut ultricies nisl sapien vel risus. Ut convallis accumsan risus eu cursus. Nam facilisis, metus eget bibendum luctus, dolor diam varius turpis, sit amet cursus elit orci id quam. Sed placerat tortor felis, eu lobortis odio varius id. Vivamus id elit neque. </p>
	</div>

	<script>
	// Set up id we're looking for
	var qs = getQueryStrings();
	var featureID = qs["id"]; 
	
	
	L.mapbox.accessToken = 'pk.eyJ1IjoidHJpcGxpbmd1YWwiLCJhIjoiUFZTSEpYNCJ9.TjhlG-pOgpKcxXt8vL-IOg';
// Mapbox light is nice and gray, appropriately muted perhaps
	var mapboxLight = L.tileLayer('https://api.mapbox.com/v4/mapbox.light/{z}/{x}/{y}.png?access_token=' + L.mapbox.accessToken, {
	    attribution: '© <a href="https://www.mapbox.com/map-feedback/">Mapbox</a> © <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
});
// Mapbox streets has the value of having country names in the/a national language
	var mapboxStreets = L.tileLayer('https://api.mapbox.com/v4/mapbox.streets/{z}/{x}/{y}.png?access_token=' + L.mapbox.accessToken, {
            attribution: '© <a href="https://www.mapbox.com/map-feedback/">Mapbox</a> © <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
});
// Mapbox satellite has the virtue of not having distracting 21st century nation-state borders
	var mapboxSatellite = L.tileLayer('https://api.mapbox.com/v4/mapbox.satellite/{z}/{x}/{y}.png?access_token=' + L.mapbox.accessToken, {
            attribution: '© <a href="https://www.mapbox.com/map-feedback/">Mapbox</a> © <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
});
// None of the Stamen tiles feel quite right. Toner's too arty, Terrain's not available in Europe, Watercolor is too sunny (and arty)
// NOTE: This attribution only valid for Toner. Watercolor and Terrain have different licensing.
//	var stamenTiles = L.tileLayer('http://tile.stamen.com/toner/{z}/{x}/{y}.jpg', {attribution: 'Map tiles by Stamen Design, under CC BY 3.0. Data by OpenStreetMap, under ODbL.'});

	var poland1939 = L.tileLayer('http://mapwarper.net/maps/tile/14002/{z}/{x}/{y}.png', {attribution: "Public domain map of Poland: National Library of Poland call no. ZZK 28 329"}),
	warsaw1938 = L.tileLayer('http://mapwarper.net/maps/tile/14004/{z}/{x}/{y}.png', {attribution: "Public domain map of Warsaw: National Library of Poland <a href='https://alpha.bn.org.pl/record=b2449341' title='National Library of Poland bibliographic entry for this map'>call no. ZZK 8 869</a>"});

	var boundaries1940 = L.mapbox.featureLayer()
		.loadURL('./data/ghetto-boundaries-1940.geojson');
	var bergMentions = L.mapbox.featureLayer()
		.loadURL('./data/berg-places.geojson');

	var map = L.map('map')
	    .addLayer(mapboxLight)
	    .addLayer(warsaw1938)
	    .addLayer(bergMentions)
	    .setView([52.252856676244804,20.986633300781246], 5);

	var baseLayers = {
	    "Grayscale": mapboxLight,
	    "Streets": mapboxStreets,
	    "Landforms": mapboxSatellite
	};

	var overlays = {
	    "Poland 1939": poland1939,
	    "Warsaw 1938/39": warsaw1938,
	    "Ghetto Boundaries 1940": boundaries1940,
	    "Mary Berg's Diary": bergMentions
	};

	L.control.layers(baseLayers, overlays).addTo(map);

/* Working 7 May 2016 4.10p */
/* using on.('layeradd') approach */
/*
	bergMentions.on('layeradd', function(e) {
		var marker = e.layer,
			feature = marker.feature;

		// Create custom popup content from the GeoJSON properties
		var popupContent =  feature.properties.addrEn;

		// bind the popup to the marker http://leafletjs.com/reference.html#popup
		marker.bindPopup(popupContent,{
			closeButton: false
		});
	});
*/

/* Working 7 May 2016 4.15p */
/* using on.('ready') approach */
	bergMentions.on('ready', function() {
		bergMentions.eachLayer(function(layer) {
			var popupContent = "<p>" + layer.feature.properties.addrEn + "</p>\n<p>" + layer.feature.properties.desc + "</p>"
			layer.bindPopup( popupContent );
		});
	    map.fitBounds(bergMentions.getBounds());
	});
	
	/* Testing filters */
	/* Working 7 May 2016 10.30p */
	// Thank you, StackOverflow
	// http://stackoverflow.com/questions/30340266/set-default-marker-filter-in-mapbox

	// This restrict what shows on the map based on a value passed in the querystring.
	bergMentions.setFilter(function(f) {
		return f.properties['id'] === featureID;
	});
	
	</script>
</body>
</html>